---
category:
  - MySQL
  - SQL优化
tag:
  - 数据库
date: 2025-11-12
star: false
---

# MySQL优化问题

1. using filesort
可以对排序的字段添加相应顺序的索引，来避免filesort。

2. using temporay
常发生在执行包含排序（GROUP BY, ORDER BY）、去重（DISTINCT）或联合（UNION）等操作的查询时。
当 MySQL 在执行查询时，无法直接通过索引获得所需的有序结果，它就需要创建一个内部临时表来存储中间结果，以便进行后续的操作（如排序、分组、去重等）。
优化 Using temporary 的核心思想是：让 MySQL 能够利用索引来直接完成排序和分组，从而避免创建临时表。
方法 1：为 GROUP BY 和 ORDER BY 字段创建索引
方法 2：减少查询字段，避免 SELECT *，如果临时表是因为要处理的数据量过大（例如，包含了 TEXT 或 BLOB 列）而被写入磁盘，那么减少查询的列数可以显著减小临时表的大小。

3. using where
表明查询使用了where子句进行条件过滤。一般在没有使用到索引的时候会出现。

4. 驱动表优化
通过SQL执行计划查看驱动表（MySQL中排前面的是驱动表），驱动表中的where条件添加索引，避免全表扫描驱动表。

5. 建立联合索引，利用覆盖索引，避免回表查询。
当一个索引包含了（或者说“覆盖了”）某个查询所需要的所有字段时，这个索引就称为覆盖索引。
这意味着，数据库引擎只需要扫描索引本身就可以获取全部所需数据，而无需再回表去查询主表（数据表）的数据行。

6. 建立联合索引，利用索引下推
在 MySQL 中，可以通过 EXPLAIN 语句来查看查询执行计划。如果 Extra 列中出现了 `Using index condition`，就表示这个查询使用了索引下推。
索引下推，也常被称为 ICP，是数据库优化器在处理查询时的一种技术。它的核心思想是：在遍历索引的过程中，尽可能早地对索引中包含的字段进行 WHERE 条件过滤，而不是等到回表之后再去过滤。
```sql
SELECT * FROM users WHERE name LIKE 'A%' AND age = 25;
```
在 (name, age) 上建立了一个联合索引 idx_name_age。

```text
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+
| id | select_type | table | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | users | NULL       | range | idx_name_age  | idx_name_age | 154     | NULL |    3 |    33.33 | Using index condition |
+----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+
```
适用情况
- 只能用于二级索引（非主键索引）：因为主键索引（聚簇索引）的叶子节点就是数据行本身，不存在“下推”的概念。
- 引用了索引中的列：WHERE 条件中需要过滤的列必须是索引的一部分。（name 和 age 都是 idx_name_age 索引的列。）
- 适用于特定的查询条件：对于 InnoDB 引擎，通常适用于 RANGE（范围）， REF（引用）， EQ_REF（等值引用） 和 INDEX_SCAN（索引扫描）等访问方法。
- 不适用于所有情况： 1。 如果查询已经使用了覆盖索引，无需回表，那么索引下推也就没有用武之地了。 2. 子查询、函数触发等复杂情况可能无法使用。

7. 函数索引（MySQL8支持），解决索引实效问题
在没有函数索引时，我们经常会遇到一种情况：即使列上有索引，但查询条件中对该列使用了函数，也会导致索引失效。
函数索引是一种基于表达式或函数计算结果来创建的索引，而不是直接基于列的原始值。
可以在一个列上应用函数（如 UPPER()、LOWER()、DATE() 等），然后为这个函数的结果建立索引，从而加速对这些函数化表达式的查询。
